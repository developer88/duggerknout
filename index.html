<!DOCTYPE html>
<html>
  <head>
    <title>Duggerknout - create route for your Google Map</title>
    <!-- Stylesheets -->
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="css/duggerknout.css" rel="stylesheet" media="screen">
  </head>
  <body>
    <div class='duggerknout-container'>
      <div class="navbar">
        <div class="navbar-inner">
          <a class="brand" href="#">Duggerknout</a>
          <ul class="nav">
            <li><a href="#loadMapModal" class="load-map" data-toggle="modal">Load Map</a></li>
          </ul>
        </div>
      </div>
      <div class="container-fluid">
        <div class="row-fluid">
          <div class="span2 sidebar">
            <div class='sidebar-helpers'>

            </div>
            <div class='routes'>
              <div class="alert alert-info">
                Please load map to start creating routes!
              </div>
            </div>
            <!--Sidebar content-->
            <p class="muted">
              © Eremin Andrey, 2013
            </p>
          </div>
          <div class="span10">
            <div id="gmap-container" class="map-container"></div>
            <!--Body content-->
          </div>
        </div>
      </div>
    </div>
    <!-- Modal window -->
    <div id="loadMapModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="loadMapModalLabel" aria-hidden="true">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3 id="loadMapModalLabel">Load Map</h3>
      </div>
      <div class="modal-body">
        <p>
          <div class="explain_kml_data"></div>
          <div class="control-group">
            <input type="text" placeholder="Type kml or GeoRSS url here..." id="kml_url" />
          </div>
        </p>
      </div>
      <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
        <button class="btn btn-primary process-map-btn">Process</button>
      </div>
    </div>    
    <!-- Javascript staff -->
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCBwT33PVGo0EVmJ2U0DC98uLN553xIZac&sensor=true">
    </script>    
    <script src="sources/dugger.js"></script>
    <!--<script src="sources/knout.js"></script>-->

    <script>
      $(document).ready(function() {

        // initialize Dugger
        var dugger = new Dugger({
          'dom': document.getElementById("gmap-container")
        });

        // Process KML Map
        $(".process-map-btn").click(function(){
          if(validate_map_source_field('#kml_url')){
            dugger.load_map($('#kml_url').val());
            $('#loadMapModal').modal('hide');
            //clean_modal();
          }
        });

        // Validate url field for modal
        function validate_map_source_field(dom) {
          if($(dom).val().length == 0){
            $(dom).parent().addClass("error");
            return false;
          }else{
            $(dom).parent().removeClass("error");
            return true;
          }
        }

        // Clean up modal when hidden
        $('#loadMapModal').on('hidden', function () {
          clean_modal();
        })

        // Clean up modal when shown
        $('#loadMapModal').on('show', function () {
          clean_modal();
        })        

        // Clean up modal
        function clean_modal() {
          $('#kml_url').parent().removeClass("error");
          $('#kml_url').val('');
        }

      });
    </script>
  </body>
</html>